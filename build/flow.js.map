{"version":3,"file":"flow.js","mappings":"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","sources":["webpack://flow/webpack/universalModuleDefinition","webpack://flow/./lib/core.ts","webpack://flow/./lib/helpers.ts","webpack://flow/./lib/methods.ts","webpack://flow/webpack/bootstrap","webpack://flow/webpack/runtime/define property getters","webpack://flow/webpack/runtime/hasOwnProperty shorthand","webpack://flow/webpack/runtime/make namespace object","webpack://flow/./lib/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(global, () => {\nreturn ","import {\n  type FlowInterface,\n  type FlowPipe,\n} from '@flow/definitions'\n\nfunction runFlow() {\n  const flow: FlowInterface = this\n  console.log('Starting flow')\n\n  if (flow.flowRunning)\n    return\n\n  flow.flowRunning = true\n\n  // TODO: Call all init pipes first, so they can properly initialize. (Needed for classes and other larger libs.)\n\n  // If no event sources, then go ahead and run flow using the first .to as our event source.\n  if (flow.pipes.events.length === 0) {\n    const target: FlowPipe = flow.pipes.targets[0]\n    callNext.call(flow, 0, target)\n    return\n  }\n\n  // For each event source, go ahead and call it to init the events.\n  const events = flow.pipes.events as Array<FlowPipe>;\n  for (const event of events) {\n    callNext.call(flow, -1, event)\n  }\n}\n\nfunction callNext(index: number, next: FlowPipe, ...params) {\n  console.log('Next target:')\n  console.log(next)\n\n  const flow: FlowInterface = this\n\n  function pipeCallback() {\n    console.log(next.target.name, 'used callback')\n    nextPipe.call(flow, index + 1, ...Array.from(arguments))\n  }\n\n  const props = [...params, ...next.params]\n  props.push(pipeCallback)\n  console.log(next.target.name, 'props', props)\n\n  // TODO: Wrap in try catch expression to catch errors.\n  const retValue = next.target.apply({}, props)\n  const retType = typeof retValue\n\n  if (retType === 'object' && retValue instanceof Promise) {\n    retValue.then((...args) => pipeCallback.call(null, ...Array.from(args)))\n  }\n\n}\n\nfunction nextPipe(index: number, ...props) {\n  console.log('next:', index)\n  console.log('args:', arguments)\n\n  const targets = this.pipes.targets\n  const next = targets[index]\n\n  // If we're at the end of the flow\n  if (!next || !next.target) {\n    this.flowRunning = false\n\n    if (this.promisified.isPromised) {\n      this.promisified.resolve(...props)\n      this.promisified.isPromised = false\n    }\n\n    return console.log('End of flow at', index)\n  }\n\n  callNext.call(this, index, next, ...props)\n}\n\nfunction handleErrors() {\n  // Special use cases\n  // You need special error handler events for modules that expect to use them\n  // You can pass these errors to typical error handlers like throw using the syntax:\n  // .onError(err => throw new Error(err))\n\n  // Once this is finished, look for any .or() branches to continue chain.\n  // .or() will start a new flow and link these two Flows together.\n}\n\nexport { runFlow }\n","// Modified from: https://cwestblog.com/2011/08/02/javascript-isprimitive-function/\nfunction isPrimitive(arg) {\n  const type = typeof arg\n  if (arg && type === 'object' && arg.then && typeof arg.then === 'function')\n    return false\n\n  return arg == null || (type != \"function\")\n}\n\nexport { isPrimitive }\n","import {\n  type FlowInterface,\n  type FlowDirection,\n  type FlowPipe,\n  type FlowTarget,\n} from '@flow/definitions'\n\nimport { isPrimitive } from '@flow/helpers'\n\nexport function isConstructor(f) {\n  try {\n    Reflect.construct(String, [], f);\n    return true\n  } catch (e) {\n    return false\n  }\n}\n\n// Pipe control\nexport function addPipe(direction: FlowDirection, target: FlowTarget, params: Array<any>): FlowInterface {\n  const pipe: FlowPipe = {\n    direction,\n    target,\n    params,\n  }\n\n  // Wrap any targets that are primitives with arrow function\n  if (typeof target !== 'function') // Because functions are also objects\n    if (isPrimitive(target))\n      pipe.target = async () => target\n\n  // Wrap any targets that are Promises with arrow function.\n  //@ts-ignore\n  if (typeof target === 'object' && typeof target.then === 'function') {\n    //@ts-ignore\n    pipe.target = (cb) => target.then(cb)\n  }\n\n  const flow = this\n  switch (pipe.direction) {\n    case 'init':\n      if (!isConstructor(target))\n        throw new Error('Flow target is not a constructor!')\n\n      //console.log('init added for:', pipe)\n      //flow.pipes.init.push(pipe)\n      //@ts-ignore\n      const instance = new target(...params)\n      flow.pipes.init.push(instance)\n\n      break\n\n    case 'from':\n      console.log('from added for:', pipe)\n      flow.pipes.events.push(pipe)\n      break\n\n    case 'to':\n      flow.pipes.targets.push(pipe)\n      break\n\n    default:\n      // Shouldn't be here.\n      console.warn('WARNING: Flow has received an unknown pipe direction. Please post a bug to the author about this.')\n      break\n  }\n\n  console.log(`Added .${direction}(${target.name || 'anonymous'})`)\n  return this\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { runFlow } from '@flow/core'\nimport {\n  type FlowInterface,\n  type FlowPipes,\n  type PipePromise,\n  FlowTarget,\n} from '@flow/definitions'\n\nimport { addPipe } from '@flow/methods'\n\nexport class Flow implements FlowInterface {\n  pipes: FlowPipes = {\n    init: [],\n    events: [],\n    targets: [],\n  }\n\n  flowRunning: boolean = false\n\n  promisified: PipePromise = {\n    isPromised: false,\n    resolve: () => {},\n    reject: () => {},\n  }\n\n\n  init = function(target: FlowTarget): Flow {\n    // If target is a class or initializer of some kind.\n    return addPipe.call(this, 'init', target, Array.from(arguments).slice(1))\n  };\n\n  to = function(target: FlowTarget): Flow {\n    return addPipe.call(this, 'to', target, Array.from(arguments).slice(1))\n  };\n\n  from = function(target: FlowTarget): Flow {\n    // Spawn a new Flow (if needed), because its a new Event Source.\n    return addPipe.call(this, 'from', target, Array.from(arguments).slice(1))\n  };\n\n  run = function(): void | Promise<any> {\n    if (this.promisified.isPromised)\n      return new Promise((resolve, reject) => {\n        this.promisified.resolve = resolve\n        this.promisified.reject = reject\n        runFlow.call(this)\n      })\n    else\n      runFlow.call(this)\n  };\n\n  waitFor = function(target: FlowTarget): Flow {\n    // waitFor will accept a conditional and value (using a proxy) or function\n    // waitFor will also accept a flow, and check if waitingForEvent = false\n    return addPipe.call(this, 'waitFor', target, Array.from(arguments).slice(1))\n  };\n\n  promisify = (): Flow => {\n    this.promisified.isPromised = true\n    return this\n  };\n\n\n  static modules: { [key: string]: any } = {}\n  modules: { [key: string]: any } = {}\n\n  thread(): FlowInterface | any {\n    return new Flow()\n  }\n\n  static use(name: string, module: any) {\n    if (this.modules[name])\n      throw new Error(name + ' collides with existing Flow module or property.')\n\n    this.modules[name] = module\n  }\n\n  constructor() {\n    //@ts-ignore\n    this.modules = this.constructor.modules\n\n    return new Proxy(this, {\n      get: function(target, property) {\n        if (Reflect.has(target, property))\n          return Reflect.get(target, property)\n        else if (Reflect.has(target.modules, property))\n          //@ts-ignore  \n          return target.modules[property]\n      }\n    }) as Flow\n  }\n}"],"names":[],"sourceRoot":""}